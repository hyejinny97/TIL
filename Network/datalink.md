# ✔ 물리 계층과 데이터 링크 계층

## 1️⃣ 이더넷

- 이더넷(ethernet)은 현대 LAN, 특히 유선 LAN 환경에서 가장 대중적으로 사용되는 기술
- 다양한 통신 매체의 규격들과 송수신되는 프레임의 형태, 프레임을 주고받는 방법 등이 정의된 네트워크 기술
- 유선 LAN 환경인 경우, 대부분 물리 계층에서는 이더넷 규격 케이블을 사용하고, 데이터 링크 계층에서 주고받는 프레임은 이더넷 프레임의 형식을 따를 것임

### 이더넷 표준

- IEEE 802.3: 이더넷 관련 다양한 표준들의 모음
- 802.3u 혹은 802.3ab처럼 숫자 뒤에 알파벳으로 버전을 나타냄
- 이더넷 표준에 따라 지원되는 네트워크 장비, 통신 매체의 종류와 전송 속도 등이 달라질 수 있음

### 통신 매체 표기 형태

```
전송 속도BASE-추가 특성
```

- ex) 10BASE-T, 100GBASE-T, 1000BASE-SX

#### 전송 속도

- 숫자만 표기되어 있으면 Mbps 속도, 숫자 뒤에 G가 붙는 경우 Gbps 속도를 의미

#### BASE

- BASEband의 약자로, 변조 타입을 의미
- 변조 타입: 비트 신호로 변환된 데이터를 통신 매체로 전송하는 방법
- 일반적인 LAN 환경에서는 대부분 디지털 신호를 송수신하는 베이스밴트 방식을 사용함

#### 추가 특성

- 통신 매체의 특성
  - 전송 가능한 최대 거리
  - 물리 계층 인코딩 방식: 데이터가 비트 신호로 변환되는 방식
  - 레인 수: 비트 신호로 옮길 수 있는 전송로 수

### 통신 매체 종류

| 통신 매체 종류 표기 | 케이블 종류            |
| ------------------- | ---------------------- |
| `C`                 | 동축 케이블            |
| `T`                 | 트위스티드 페어 케이블 |
| `S`                 | 단파장 광섬유 케이블   |
| `L`                 | 장파장 광섬유 케이블   |

- 이더넷 표준과 통신 매체의 표기가 항상 일대일로 대응되는 것은 아님

  | 표준 규격   | 통신 매체            |
  | ----------- | -------------------- |
  | IEEE802.3i  | 10BASE-T             |
  | IEEE802.3u  | 100BASE-TX           |
  | IEEE802.3ab | 1000BASE-T           |
  | IEEE802.3bz | 2.5GBASE-T, 5GBASE-T |

### 이더넷 프레임

- 이더넷 프레임 구조
  - 헤더
    - 프리앰블
    - 수신지 MAC 주소, 송신지 MAC 주소
    - 타입/길이
  - 페이로드
    - 데이터
  - 트레일러
    - FCS

#### 프리앰블

- 이더넷 프레임의 시작을 알리는 8바이트 크기의 정보
- 첫 7바이트는 10101010 값을 가지고, 마지막 바이트는 10101011 값을 가짐
- 송수신지 간의 동기화를 위해 사용됨

#### 수신지 MAC 주소, 송신지 MAC 주소

- MAC 주소
  - '물리적 주소'
  - 네트워크 인터페이스마다 부여되는 6바이트 길이의 주소 (16진수 12자리)
  - 일반적으로 고유하고, 변경되지 않는 주소
  - LAN 내의 수신지와 송신지를 특정할 수 있음
- 보통 NIC(Network Interface Controller)라는 장치가 네트워크 인터페이스 역할을 담당함
  - 한 컴퓨터에 NIC가 여러 개 있다면 MAC 주소도 여러 개 있을 수 있음

#### 타입/길이

- 필드에 명시된 크기가 1500 이하일 경우 프레임 크기를 나타내는 데 사용되고, 1536 이상일 경우 타입을 나타내는 데 사용됨
- 타입: 이더넷 프레임이 어떤 정보를 캡슐화됐는지를 나타냄
  - 대표적으로 상위 계층에서 사용된 프로토콜의 이름이 명시됨

| 타입 | 프로토콜 |
| ---- | -------- |
| 0800 | IPv4     |
| 86DD | IPv6     |
| 0806 | ARP      |

#### 데이터

- 네트워크 계층의 데이터와 헤더를 합친 PDU
- 최대 크기는 1500 바이트로, 반드시 46바이트 이상이어야 함
- 패딩: 46바이트 이하의 데이터일 경우 0으로 채워짐

#### FCS

- Frame Check Sequence
- 수신한 이더넷 프레임에 오류가 있는지 확인하기 위한 필드
- 이 필드에는 CRC(Cyclic Redundancy Check), 즉 순환 중복 검사라고 불리는 오류 검출용 값이 들어감
- 오류 검출 과정
  - 송신지는 프리앰블을 제외한 나머지 필드 값들을 바탕으로 CRC 값을 계산한 후, 이 값을 FCS 필드에 명시함
  - 수신지는 수신한 프레임에서 프리앰블과 FCS 필드를 제외한 나머지 필드 값을 바탕으로 CRC 값을 계산한 뒤, 이 값을 FCS 필드 값과 비교함
  - 비교 값이 일치하기 않으면 프레임에 오류가 있다고 판단하여 해당 프레임을 폐기함

### cf) 토큰 링

- 이더넷 외에 다른 LAN 기술
- 토크 링 네트워크에서는 호스트들이 고리 형태로 연결됨
- 호스트들끼리 돌아가며 토큰이라는 정보를 주고받는데, 네트워크 내 다른 호스트에게 메시지를 송신하려면 반드시 이 토큰을 가지고 있어야 함

## 2️⃣ NIC와 케이블

### NIC

- Network Interface Controller
- 네트워크 인터페이스 카드, 네트워크 어댑터, LAN 카드, 이더넷 카드 등으로도 불림
- 호스트와 유무선의 통신 매체를 연결하고, 통신 매체를 통해 전달되는 신호와 컴퓨터가 이해할 수 있는 정보 간에 변환을 담당하는 네트워크 장비
- '호스트를 네트워크(LAN)에 연결하기 위한 하드웨어'
- MAC 주소가 부여됨

#### NIC의 생김새

- USB로 연결하는 NIC도 있고, 마더보드에 내장된 NIC도 있음

#### NIC의 역할

- 통신 매체에 흐르는 신호를 호스트가 이해하는 프레임으로 변환하거나 반대로 호스트가 이해하는 프레임을 통신 매체에 흐르는 신호로 변환함
- MAC 주소를 통해 자기 주소는 물론, 수신되는 프레임의 수신지 주소를 인식함
- 따라서, 자신과 관련 없는 수신지 MAC 주소가 명시된 프레임을 받거나, FCS 필드를 토대로 오류를 검출해 잘못된 프레임을 받으면 폐기할 수 있음

### 트위스티드 페어 케이블

- 케이블: NIC에 연결되는 물리 계층의 유선 통신 매체
- 트위스티드 페어 케이블: 구리 선으로 전기 신호를 주고받는 통신 매체

#### 트위스티드 페어 케이블의 생김새

- 케이블 본체와 케이블의 연결부인 커넥터로 이루어짐
- RJ-45: 트위스티드 페어 케이블에서 주로 활용되는 커넥터
- 케이블 본체 내부에는 구리 선이 두 가닥씩 꼬아져 있음

#### 실드에 따른 트위스티드 페어 케이블의 종류

- 트위스티드 페어 케이블은 구리 선으로 이루어져 있기 때문에 노이즈에 민감함
  - 노이즈: 전기 신호를 왜곡시킬 수 있는 간섭
- 차폐(shielding): 구리 선 주변을 감싸 노이즈를 감소시키는 방식
- STP(Shielded Twisted Pair): 브레이브 실드로 구리 선을 감싸 노이즈를 감소시킨 트위스티드 페어 케이블
- FTP(Foil Twisted Pair): 포일 실드로 구리 선을 감싸 노이즈를 감소시킨 트위스티드 페어 케이블
- UTP(Unshielded Twisted Pair): 아무것도 감싸지 않은 구리 선만 있는 트위스티드 페어 케이블

```
XX/YTP
```

- X, Y에 명시할 수 있는 케이블
  - U: 실드 없음
  - S: 브레이드 실드
  - F: 포일 실드
- XX에는 케이블 외부를 감싸는 실드의 종류가 명시됨
- Y에는 꼬인 구리 선 쌍을 감싸는 실드의 종류가 명시됨
- ex) S/FTP 케이블, SF/FTP 케이블, U/UTP 케이블

#### 카테고리에 따른 트위스티드 페어 케이블의 분류

- 카테고리는 트위스티드 페어 케이블 성능의 등급을 구분하는 역할을 함
- 카테고리에 따라 지원 대역폭, 주요 대응 규격, 전송 속도와 같은 케이블의 성능이 각각 다름
- 카테고리가 높은 트위스티드 페어 케이블일수록 송수신할 수 있는 데이터의 양이 더 많고, 더 빠른 전송이 가능함

| 특징           | Cat5       | Cat5e       | Cat6        | Cat6a      | Cat7       | Cat8       |
| -------------- | ---------- | ----------- | ----------- | ---------- | ---------- | ---------- |
| 지원 대역폭    | 100MHz     | 100MHz      | 250MHz      | 500MHz     | 600MHz     | 2GHz       |
| 주요 대응 규격 | 100BASE-TX | 1000BASE-TX | 1000BASE-TX | 10GBASE-TX | 10GBASE-TX | 40GBASE-TX |
| 전송 속도      | 100Mbps    | 1Gbps       | 1Gbps       | 10GMbps    | 10Gbps     | 40Gbps     |

### 광섬유 케이블

- 빛(광신호)을 이용해 정보를 주고받는 케이블
- 전기 신호를 이용하는 케이블에 비해 속도도 빠르고, 먼 거리까지 전송 가능하며, 노이즈로부터 간섭받는 영향도 적음
- 따라서, 대륙 간 네트워크 연결에도 사용됨

#### 광섬유 케이블의 생김새

- 케이블 본체와 커넥터로 이루어짐
- 커넥터 종류: LC 커넥터, SC 커넥터, FC 커넥터, ST 커넥터
- 케이블 본체 내부는 광섬유로 구성됨
- 광섬유 중심에는 코어가 있고, 코어를 둘러싸는 클래딩이 있음
  - 코어: 광섬유에서 실질적으로 빛이 흐르는 부분
  - 클래딩: 빛이 코어 안에서만 흐르도록 빛을 가두는 역할
- 코어의 지름에 따라 싱글 모드 광섬유 케이블(SMF), 멀티 모드 광섬유 케이블(MMF)로 나뉨

#### 싱글 모드 광섬유 케이블

- 코어의 지름이 8~10μm 정도로, 멀티 모드 광섬유 케이블에 비해 작음
- 코어의 지름이 작기 때문에 빛의 이동 경로가 하나 이상을 갖기 어려움
- 신호 손실이 적어 장거리 전송에 적합함
- 긴 파장의 빛을 사용함
  - 대표적인 싱글 모드 광섬유 케이블 규격: 1000BASE-LX, 10GBASE-LR

#### 멀티 모드 광섬유 케이블

- 코어의 지름이 50~62.5μm 정도로, 싱글 모드 광섬유 케이블보다 큼
- 코어의 지름이 크기 때문에 빛의 이동 경로는 여러 개를 가짐
- 신호 손실이 크기 때문에 장거리 전송에는 부적합함 (근거지 전송에 주로 사용)
- 단파장의 빛을 사용함
  - 대표적인 멀티 모드 광섬유 케이블 규격: 1000BASE-SX, 10GBASE-SR

## 3️⃣ 허브

- 대표적인 네트워크 장비로 물리 계층에는 **허브**가 있고, 데이터 링크 계층에는 **스위치**가 있음
- 사실, 허브는 오늘날 인터넷 환경에서 잘 사용되진 않음

### 주소 개념이 없는 물리 계층

- 물리 계층에는 주소 개념이 없기 때문에, 물리 계층의 네트워크 장비는 송수신되는 정보에 대한 어떠한 조작(송수신 내용 변경)이나 판단을 하지 않음
  - 반면, 데이터 링크 계층에는 주소 개념이 있음 (MAC 주소)

### 허브

- 물리 계층의 허브는 여러 대의 호스트를 연결하는 장치임
- 포트(port)를 통해 호스트와 연결된 통신 매체를 연결할 수 있음

#### 허브의 특징

##### 1. 전달받은 신호를 다른 모든 포트로 그대로 다시 내보냄

- 신호를 전달 받으면 어떠한 조작이나 판단을 하지 않고 송신지를 제외한 모든 포트에 그저 내보내기만 함
- 신호를 전달 받은 모든 호스트는 데이터 링크 계층에서 패킷의 MAC 주소를 확인하고 자신과 관련 없는 주소는 폐기함

##### 2. 반이중 모드로 통신함

- 반이중(half duplex) 모드: 한 번에 한 방향으로만 전송할 수 있는 통신 방식
- 전인중(full duplex) 모드: 동시에 양방향으로 데이터를 전송할 수 있는 통신 방식

#### 콜리전 도메인

- 허브는 반이중 통신을 지원하므로 한 호스트가 허브에 송신하는 동안 다른 호스트는 송신하면 안됨
- 만약, 서로 다른 호스트가 동시에 허브에 신호를 송신하면 충돌(콜리전)이 발생함
- 허브에 호스트가 많이 연결되어 있을수록 충돌 발생 가능성이 높음
- 콜리전 도메인: 충돌이 발생할 수 있는 영역
  - 허브에 연결된 모든 호스트는 같은 콜리전 도메인에 속함
- 충돌 문제 해결 방법
  - CSMA/CD 프로토콜 사용
  - 스위치 장비 사용

### CSMA/CD

- Carrier Sense Multiple Access with Collision Detection
- 반이중 이더넷 네트워크에서 충돌을 방지하는 대표적인 프로토콜

#### 1. CS (Carrier Sense) - 캐리어 감지

- 메시지를 보내기 전 현재 네트워크 상에서 전송 중인 것이 있는지를 먼저 확인
- 즉, 현재 통신 매체의 사용 가능 여부를 검사

#### 2. MA (Multiple Access) - 다중 접근

- 복수의 호스트가 네트워크에 동시에 접근해 충돌이 발생

#### 3. CD (Collision Detection) - 충돌 검출

- 충돌을 감지하면 전송을 중단하고, 충돌을 검출한 호스트는 다른 이들에게 잼 신호를 보내 충돌이 발생했음을 알림
- 그리고 임의의 시간 동안 기다린 뒤에 다시 전송함

## 4️⃣ 스위치

### 스위치

- 데이터 링크 계층의 네트워크 장비
- 허브와 유사하게 스위치의 여러 포트에 호스트 연결 가능
- MAC 주소를 학습해 특정 MAC 주소를 가진 호스트에만 프레임을 전달할 수 있음
- 전이중 모드의 통신을 지원
  - 따라서, 포트별로 콜리전 도메인이 나뉘고 CSMA/CD 프로토콜이 필요하지 않음

#### 스위치의 특징

- 특정 포트와 해당 포트에 연결된 호스트의 MAC 주소와의 관계를 기억해 원하는 호스트에만 프레임을 전달할 수 있음
- MAC 주소 테이블: 스위치의 포트와 연결된 호스트의 MAC 주소 연관 관계를 나타내는 정보 (MAC 주소 학습을 통해 알아냄)

### MAC 주소 학습

- 스위치의 MAC 주소 학습은 프레임 내 '송신지 MAC 주소' 필드를 바탕으로 이루어짐

#### 1. 플러딩 (Flooding)

- 현재 스위치의 포트에 호스트 A, B, C, D가 연결되어 있고, MAC 주소 테이블은 비어있는 상황임
- 호스트 A가 호스트 C에게 메시지를 보내려함
- 스위치는 호스트 A가 보낸 프레임의 '송신지 MAC 주소'를 바탕으로, 호스트 A의 MAC 주소와 연결된 포트를 MAC 주소 테이블에 저장함
- 호스트 C가 연결된 포트를 모르므로 송신지 포트를 제외한 모든 포트로 프레임을 전송함 (플러딩)
- 호스트 B, D는 자신과 관련이 없는 프레임이므로 이를 폐기하고, 호스트 C는 스위치로 응답 프레임을 전송함
- 스위치는 호스트 C가 보낸 응답 프레임의 '송신지 MAC 주소'를 바탕으로, 호스트 C의 MAC 주소와 연결된 포트를 MAC 주소 테이블에 저장함

#### 2. 필터링 (Filtering), 포워딩 (Forwarding)

- 필터링: 전달받은 프레임을 어디로 내보내고 어디로 내보내지 않을지 결정
- 포워딩: 프레임이 전송될 포트에 실제로 프레임을 내보내는 것
- 스위치는 호스트 A, C의 MAC 주소와 연결된 포트를 알고 있으므로, 호스트 A가 호스트 C에게 프레임을 전송하면 스위치는 호스트 B, D가 연결된 포트로는 내보내지 않도록 필터링하고, 호스트 C가 연결된 포트로 프레임을 포워딩함

#### 3. 에이징 (Aging)

- 만약 MAC 주소 테이블에 등록된 특정 포트에서 일정 시간 동안 프레임을 전송받지 못했다면 해당 항목은 삭제하게 됨 (에이징)

### VLAN

- Virtual LAN
- 한 대의 스위치로 가상의 LAN을 만드는 방법
- 스위치에 연결된 호스트 중에서도 서로 메시지를 주고 받을 일이 적거나 브로드캐스트 메시지를 받을 필요가 없어서 굳이 같은 LAN에 속할 필요가 없는 호스트가 있을 수 있음
- VLAN을 구성하면 한 대의 물리적 스위치라 해도 여러 대의 스위치가 있는 것처럼 논리적인 단위로 LAN을 구획할 수 있음
  - 브로드캐스트 도메인이 달라지게 됨
- VLAN1에 속한 호스트가 VLAN2에 속한 호스트와 통신하고자 한다면 네트워크 계층 이상의 상위 계층 장비가 필요함

#### 포트 기반 VLAN

- 스위치의 포트가 VLAN을 결정하는 방식
- 사전에 특정 포트에 VLAN을 할당하고, 해당 포트에 호스트를 연결함으로써 VLAN에 포함시킬 수 있음

#### MAC 기반 VLAN

- 사전에 설정된 MAC 주소에 따라 VLAN을 결정하는 방식
